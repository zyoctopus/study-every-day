#### 什么是CDN

内容分发网络（Content Delivery Network），改善互联网内容的分发，尽量做到无阻塞分发；
> 核心理念是，将内容缓存在终端用户附近，这样用户的访问速度就加快了；因为这项技术是把内容进行了分发，所以名字就叫内容分发网络；具体的就是CDN采用了更多的缓存服务器（CDN边缘节点），布放在用户访问相对集中的地区或者网络中；当用户访问网络时，利用全局负载技术，将用户的访问指向距离最近的缓存服务器上，由缓存服务器响应用户请求。（类似京东的本地仓库，从而做到最快的将商品送到用户手中）

##### 与镜像服务的区别

镜像服务器是源内容服务器的完整复制，而CDN是部分内容的缓存，智能程度更高；而且还需要注意的是，CDN并不是只能缓存视频内容，它还可以对网站的静态资源（例如各类型图片、html、css、js等）进行分发，对移动应用APP的静态内容（例如安装包apk文件、APP内的图片视频等）进行分发。

#### CDN出现的原因
1. 从互联网的架构来看，不同网络之间的互联互通带宽，对任何一个运营商网络的流量来说，占比都比较小，收敛比是非常高的，因此这里通常都是互联网传输中的拥堵点（运营商互联互通的问题）；
2. 由于互联网的发展，骨干网络的压力越来越大，当骨干网络的升级和扩容滞后于互联网之上的应用的发展时，就会阶段性地使得大型骨干网的承载能力成为影响互联网性能的瓶颈（区域互联互通问题，骨干网带宽瓶颈），大量用户访问的时候无法及时响应用户的访问需求，对业务造成了巨大影响；

#### CDN具体工作流程
1. 当用户点击APP上的内容，APP会根据URL地址去本地DNS（域名解析系统）寻求IP地址解析。
2. 本地DNS系统会将域名的解析权交给CDN专用DNS服务器。
3. CDN专用DNS服务器，将CDN的全局负载均衡设备IP地址返回用户。
4. 用户向CDN的负载均衡设备发起内容URL访问请求。
5. CDN负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的缓存服务器。
6. 负载均衡设备告诉用户这台缓存服务器的IP地址，让用户向所选择的缓存服务器发起请求。
7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。
8. 如果这台缓存服务器上并没有用户想要的内容，那么这台缓存服务器就要网站的源服务器请求内容。
9. 源服务器返回内容给缓存服务器，缓存服务器发给用户，并根据用户自定义的缓存策略，判断要不要把内容缓存到缓存服务器上。

#### CDN的好处
1. 加速了网站访问，用户与内容之间的物理距离缩短从而用户等待时间缩短了；
2. 分发至不同线路的缓存服务器，也让跨运营商之间的访问得以加速；例如中国移动手机用户访问中国电信网络的内容源，可以通过在中国移动架设CDN服务器，进行加速。效果是非常明显的。
3. CDN还有安全方面的好处。内容进行分发后，源服务器的IP被隐藏，受到攻击的概率会大幅下降。而且，当某个服务器故障时，系统会调用临近的健康服务器 进行服务，避免对用户造成影响。

#### 典型CDN的组成
* 分发服务系统：基本工作单元Cache设备，cache（边缘cache）负责直接响应最终用户访问需求，把缓存在本地的内容快速返回给用户；cache同时负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存在本地。
> Cache设备的数量、规模、总服务能力是衡 量一个CDN系统服务能力的最基本的指标。
* 负载均衡系统：主要功能是负责对所有发起服务请求的用户进行访问调度，确定提供给用户的最终实际访问地址。两级调度体系分为全局负载均衡（GSLB）和本 地负载均衡（SLB）。GSLB主要根据用户就近性原则，通过对每个服务节点进行“最优”判断，确定向用户提供服务的cache的物理位置。SLB主要负 责节点内部的设备负载均衡；
* 运营管理系统：分为运营管理和网络管理子系统，负责处理业务层面的与外界系统交互所必须的收集、整理、交付工作，包含客户管理、产品管理、计费管理、统计分析等功能。

> 负责为用户提供内容服务的cache设备应部署在物理上的网络边缘位置，即CDN边缘层。CDN系统中负责全局性管理和 控制的设备组成中心层（二级缓存），中心层同时保存着最多的内容副本，当边缘层设备未命中时，会向中心层请求，如果在中心层仍未命中，则需要中心层向源站回源。

> CDN骨干点和CDN POP点在功能上不同，中心和区域节点一般称为骨干点，主要作为内容分发和边缘未命中时的服务点；边缘节点又被称为POP（point of presence）节点，CDN POP点主要作为直接向用户提供服务的节点。